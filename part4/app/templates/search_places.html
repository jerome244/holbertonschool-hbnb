{% extends 'base.html' %}

{% block title %}Search Places - HBnB{% endblock %}

{% block content %}
<h1 class="text-center">Search for Places</h1>

<!-- Page Grid Layout -->
<div class="page-layout">
  <!-- First Row: Search Form and Map -->
  <form method="GET" action="{{ url_for('places.search_places') }}">
    <div class="search-fields">
      <div class="form-group">
        <label for="location">Location (optional):</label>
        <input
          type="text"
          id="location"
          name="location"
          placeholder="e.g. 12 Main Street, Paris, France"
          autocomplete="off"
          value="{{ request.args.get('location', '') }}"
        />
        <small class="text-muted">
          Tip: Enter full street address, city, and country for best results.
        </small>
        <div id="autocomplete-results" class="autocomplete-results"></div>
      </div>

      <div class="form-group">
        <label for="price">Max Price (optional):</label>
        <select id="price" name="price">
          <option value="10">Up to $10</option>
          <option value="50">Up to $50</option>
          <option value="100">Up to $100</option>
          <option value="">All Prices</option>
        </select>
      </div>

      <div class="form-group">
        <button type="submit" class="btn btn-primary">Search</button>
      </div>
    </div>
  </form>

  <!-- Map Section (Right) -->
  <div class="map-section">
    <div id="map" class="map-container"></div>
  </div>

  <!-- Search Results Section -->
  <div class="search-results">
    {% if places %}
      <h2>Search Results</h2>
      <div class="place-cards-grid">
        {% for place in places %}
          <div class="place-card">
            <a href="{{ url_for('places.place', place_id=place.id) }}">
              <h3>{{ place.title }}</h3>
            </a>
            <p>${{ place.price }} per night</p>
            {% if place.photos and place.photos|length > 0 %}
              <img src="{{ url_for('static', filename='uploads/' + place.photos[0].url) }}" alt="Photo of {{ place.title }}">
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No places found.</p>
    {% endif %}
  </div>
</div>

<!-- Leaflet CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

<!-- Leaflet MarkerCluster CSS & JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css">
<script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>

<!-- Your autocomplete and map script -->
<script src="{{ url_for('static', filename='js/modules/search_places.js') }}"></script>

<!-- Link to new max price filter JS -->
<script src="{{ url_for('static', filename='js/modules/max-price-filter.js') }}"></script>

{% endblock %}
